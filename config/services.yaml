services:
  _defaults:
    autowire: true
    public: false
    bind:
      Psr\Cache\CacheItemPoolInterface: '@cache'
      $environment: '%kernel.environment%'

  App\:
    resource: '../src/*'
    exclude: '../src/{Entity,Migrations,Tests,Kernel.php}'

  App\Controller\:
    resource: '../src/Controller/*'
    public: true
    tags: ['app.controller']

  App\Security\Voter\:
    resource: '../src/Security/Voter/*'
    tags: ['app.security.voter']

  App\Middleware\:
    resource: '../src/Middleware/*'
    exclude: '../src/Middleware/{Router.php}'
    public: true


  # ---------------

  cache:
    alias: cache.filesystem

  cache.void:
    class: Cache\Adapter\Void\VoidCachePool

  cache.filesystem:
    class: Cache\Adapter\Filesystem\FilesystemCachePool

  League\Flysystem\Filesystem:
    arguments: ['@League\Flysystem\Adapter\Local']

  League\Flysystem\Adapter\Local:
    arguments: ['%kernel.project_dir%/var/cache/%kernel.environment%/fs']

  App\Middleware\SecurityVoters:
    public: true
    arguments: [!tagged app.security.voter]

  App\DataCollector\CacheDataCollector:
    decorates: 'cache'
    arguments: ['@App\DataCollector\CacheDataCollector.inner']
